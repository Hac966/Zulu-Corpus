{% extends 'home.html' %}
{% load static %}

{% block title %} search_entry {% endblock title %}
{% block style %}
<style>
    /* Styling for the speak button */
    .speak-button{
        width: 2em;
        height: 2em;
        position: absolute;
        top: 1em;
        right: 1em;
        border-radius: 100%;
        border: none;
        color: black;
        background-color: white;
        }

    /* Styling for the like button (optional, but good for appearance) */
    .like-form button {
        position: absolute;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.5em; /* Make the heart visible */
        color: red; /* Make the heart stand out */
        top: 0.3em;
        right: 1.5em;
    }

    #search-results{
        position: relative;
    }

    .entryHeading {
    font-size: 24px;
    font-weight: 600;
    color: white;
    overflow-wrap: break-word;

    }

    .entryStatsButton{
        height: 2.5em;
        width: 2.5em;
        border-radius: 100%;
        position: absolute;
        right: 0;
        border: none;
        color: black;
        background-color: white;
    }

    .entryStats{
        border-top: 2px solid #4a5568;

    }


</style>
{% endblock style %}

{% block theCore %}

{% if entries %}
    {% for entry in entries %}
        <div id="search-results" class="entry">
            <h1 class="entryHeading">{{entry.isizulu}} </h1>
            <div style="display: flex; align-items: center; justify-content: space-between; overflow-wrap: break-word;">
                <div style="display: flex; align-items: center; overflow-wrap: break-word;">


                    {% if request.user.is_authenticated %}
                    <form method="POST" action="{% url 'like_entry' entry.id %}" class="like-form">
                        {% csrf_token %}
                        {% if request.user in entry.likes.all %}
                            <button  type="submit" title="Remove from Favorites">üíô</button>
                        {% else %}
                            <button type="submit" title="Add to Favorites">ü§ç</button>
                        {% endif %}
                    </form>
                    {% endif %}
                    </div>
                <button class="speak-button" onclick="speak('{{ entry.isizulu}}')"><i class="bi bi-volume-up"></i></button>
            </div>
            <p class="english">"{{entry.english}}"</p>
            <p class="text-content"><strong>Extract:</strong> {{entry.extract}}</p>

            <div class="bottom-section">
                <span class="tag">IsiXhosa: {{entry.isixhosa}}</span>
                <span class="tag">Isipedi: {{entry.isipedi}} </span>
                <a href="{{entry.learn_more}}" ><button id="button" class="entryButton">
                    Learn more
                </button></a>
                <button class="entryStatsButton">v</button>

            </div> <br>
            <div class="entryStats hidden">
                <h3>Entry Stats:</h3>
                <p class="text-content"><strong>Word usage:</strong> {{entry.word_usage}}</p>
                <p class="text-content"><strong>Searched times:</strong> {{entry.word_frequency}}</p>
                <p class="text-content"><strong>Word frequency:</strong> {{entry.word}}</p>
                <p class="text-content"><strong>Commonly paired:</strong> {{ entry.commonly }}</p>
                <p class="text-content">
        <strong>Component Frequencies:</strong> {{ entry.get_component_frequencies }}
    </p>
            </div>

        </div>
    {% endfor %}
{% else %}
    <div style="padding: 20px; border: 1px solid #ccc; background-color: #f8f8f8;">
        <p>Sorry, **"{{ searched|default:'your query' }}"** is not currently in our database.</p>
        <p>Please check your spelling or try a different word.</p>
    </div>
{% endif %}

{% endblock theCore %}

{% block script %}
<script src="{% static 'script.js' %}"></script>
<script>
function speak(textToSpeak){
    if (textToSpeak && window.speechSynthesis) {
        window.speechSynthesis.cancel();
        const audio = new SpeechSynthesisUtterance(textToSpeak);
        audio.lang = 'zu-ZA'; // Use appropriate language code
        window.speechSynthesis.speak(audio);
    } else {
        console.error("Speech synthesis not available or text is empty.");
    }
}


let viewStatsButtons = document.querySelectorAll(".entryStatsButton");

viewStatsButtons.forEach(button => {
    button.addEventListener('click', function() {
        const entryDiv = this.closest('.entry');
        const entryStats = entryDiv.querySelector('.entryStats');

        if (entryStats) {
            entryStats.classList.toggle('hidden');

            this.textContent = entryStats.classList.contains('hidden') ? 'v' : '^';
        }
    });
});
</script>
{% endblock script %}